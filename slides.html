<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><!--*- nxml -*-->
<html xmlns="http://www.w3.org/1999/xhtml">
  <!-- $Id: mks5,v 1.4 2012/01/24 20:41:43 cabo Exp cabo $ -->
  <!-- $Id: nö? $ -->
<head>
                            <title>Ruby On Rails: Best Practices</title>
<!-- metadata -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="S5" />
<meta name="version" content="S5 1.1" />
<meta name="presdate" content="2014-04-01" />
<meta name="author" content="Julian Kornberger" />
<meta name="company" content="Digineo GmbH" />
<!-- configuration parameters -->
<meta name="defaultView" content="slideshow" />
<meta name="controlVis" content="hidden" />
<!-- style sheet links -->
<link rel="stylesheet" href="ui/default/slides.css" type="text/css" media="projection" id="slideProj" />
<link rel="stylesheet" href="ui/default/outline.css" type="text/css" media="screen" id="outlineStyle" />
<link rel="stylesheet" href="ui/default/print.css" type="text/css" media="print" id="slidePrint" />
<link rel="stylesheet" href="ui/default/opera.css" type="text/css" media="projection" id="operaFix" />
<link rel="stylesheet" href="ui/default/ruby.css" type="text/css" />
<link rel="stylesheet" href="ui/default/xml.css" type="text/css" />
<link rel="stylesheet" href="ui/default/eiffel.css" type="text/css" />
<!-- S5 JS -->
<script src="ui/default/slides.js" type="text/javascript"></script>
<!-- Fuer s6 aus Kommentar herausnehmen:
<script src="ui/default/s6.js" type="text/javascript"></script>
 -->
</head>
<body>

<div class="layout">
<div id="controls"><!-- DO NOT EDIT --></div>
<div id="currentSlide"><!-- DO NOT EDIT --></div>
<div id="header"></div>
<div id="footer">
<h1>Julian Kornberger 2014-04-01</h1>
<h2>Ruby On Rails: Best Practices</h2>
</div>

</div>


<div class="presentation">
<div class="slide">

	<h1>RoR: Best Practices</h1>


	<h2>Digineo GmbH 2014-04-01</h2>


	<h3>Julian Kornberger</h3>


	<h4>jk@digineo.de</h4>


</div>
<div class="slide">

	<h1>Gemfile</h1>


	<p>Versionsnummern angeben:</p>


<div class="CodeRay">
  <div class="code"><pre>gem <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">rails</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&gt;= 4.0.4</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt; 4.1</span><span style="color:#710">'</span></span>
gem <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">rails</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">~&gt; 4.0.4</span><span style="color:#710">'</span></span> <span style="color:#777"># Twiddle Wakka (aka Pessimistic Operator)</span>
</pre></div>
</div>


	<p>Repositories referenzieren:</p>


<div class="CodeRay">
  <div class="code"><pre>gem <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">bootstrap-sass</span><span style="color:#710">'</span></span>, <span style="color:#606">git</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">git://git.twitter.com/bootstrap.git</span><span style="color:#710">'</span></span>
gem <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">bootstrap-sass</span><span style="color:#710">'</span></span>, <span style="color:#606">github</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">twbs/bootstrap-sass</span><span style="color:#710">'</span></span>, <span style="color:#606">branch</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">testing</span><span style="color:#710">'</span></span>
</pre></div>
</div>


	<p>Kommentare für weniger bekannte Gems.</p>


<div class="CodeRay">
  <div class="code"><pre><span style="color:#777"># Öffnet automatisch erzeugte E-Mails (delivery_method setzen!)</span>
gem <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">letter_opener</span><span style="color:#710">'</span></span>, <span style="color:#606">group</span>: [<span style="color:#A60">:development</span>]
</pre></div>
</div>


</div>
<div class="slide">

	<h1>User Interface</h1>


	<p>DOs:</p>


	<ul>
	<li>Twitter Bootstrap als <span class="caps">CSS</span>-Framwork (bootstrap-sass, bootsnipp.com)</li>
		<li>Font Awesome für Icons (font-awesome-rails)</li>
		<li>SimpleForm für Formulare (simple_form)
	<ul>
	<li>Setup für Bootstrap kompliziert</li>
	</ul>
	</li>
		<li>Kaminari für Pagination (kaminari)</li>
	</ul>


	<p>DONTs:</p>


	<ul>
	<li>jQuery UI verwenden</li>
		<li>less-rails benutzen (wenn sass-rails benutzt wird)</li>
	</ul>


</div>
<div class="slide">

	<h1>Migrations / Seeds</h1>


	<p>Migrations während der Entwicklungsphase nachträglich ändern.
Datenbank zurücksetzen mit:</p>


<pre><code>rake db:migrate:reset &#38;&#38; rake db:seed
</code></pre>

	<p>Alles was für eine Test-Installation notwendig ist in die Seeds:</p>


<div class="CodeRay">
  <div class="code"><pre><span style="color:#777"># db/seeds.rb</span>
user = <span style="color:#036;font-weight:bold">User</span>.create <span style="color:#606">email</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">admin@example.com</span><span style="color:#710">'</span></span>, <span style="color:#606">password</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">foobar12</span><span style="color:#710">'</span></span>
user.projects.create! <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">AWE14</span><span style="color:#710">&quot;</span></span>
...
</pre></div>
</div>


	<p>Setup-Prozess in <span class="caps">README</span> dokumentieren</p>


</div>
<div class="slide">

	<h1><span class="caps">SQL</span> Constraints (1/2)</h1>


	<p><span class="caps">NULL</span> Constraints</p>


<div class="CodeRay">
  <div class="code"><pre>create_table <span style="color:#A60">:users</span> <span style="color:#080;font-weight:bold">do</span> 
  t.string <span style="color:#A60">:email</span>, <span style="color:#606">null</span>: <span style="color:#069">false</span>
  t.timestamps <span style="color:#606">null</span>: <span style="color:#069">false</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>


	<p><span class="caps">UNIQUE</span> Constraints</p>


<div class="CodeRay">
  <div class="code"><pre>add_index <span style="color:#A60">:users</span>, <span style="color:#A60">:email</span>, <span style="color:#606">unique</span>: <span style="color:#069">true</span>
add_index <span style="color:#A60">:projects_users</span>, [<span style="color:#A60">:project_id</span>, <span style="color:#A60">:user_id</span>], <span style="color:#606">unique</span>: <span style="color:#069">true</span>
</pre></div>
</div>


</div>
<div class="slide">

	<h1><span class="caps">SQL</span> Constraints (2/2)</h1>


	<p><span class="caps">FOREIGN KEY</span> Constraints für referenzielle Integrität (Gem: foreigner):</p>


	<p><span class="caps">NO ACTION</span></p>


<div class="CodeRay">
  <div class="code"><pre>add_foreign_key <span style="color:#A60">:comments</span>, <span style="color:#A60">:posts</span>
</pre></div>
</div>


	<p><span class="caps">SET NULL</span></p>


<div class="CodeRay">
  <div class="code"><pre>add_foreign_key <span style="color:#A60">:comments</span>, <span style="color:#A60">:posts</span>, <span style="color:#606">dependent</span>: <span style="color:#A60">:nullify</span>
</pre></div>
</div>


	<p><span class="caps">CASCADE</span></p>


<div class="CodeRay">
  <div class="code"><pre>add_foreign_key <span style="color:#A60">:comments</span>, <span style="color:#A60">:posts</span>, <span style="color:#606">dependent</span>: <span style="color:#A60">:delete</span>
</pre></div>
</div>


</div>
<div class="slide">

	<h1>Background Jobs (1/3)</h1>


	<p>Problem:</p>


	<ul>
	<li><span class="caps">HTTP</span>-Request sollte innerhalb 1 Sek. beantwortet werden (besser &lt; 100ms)</li>
		<li>Sonst: Schlechte User-Experience, Anfällig für <span class="caps">DOS</span></li>
	</ul>


	<p>Lösung:</p>


	<ul>
	<li>Asynchrone Ausführung im Hintergrund.</li>
		<li>Status-Updates per Refresh / <span class="caps">AJAX</span>-Polling / Server Side Events</li>
	</ul>


</div>
<div class="slide">

	<h1>Background Jobs (2/3)</h1>


	<p>Way to Go: Sidekiq + Redis</p>


	<ul>
	<li>Multithreading, mehrere Queues</li>
		<li>Job scheduling, Job retry</li>
	</ul>


<div class="CodeRay">
  <div class="code"><pre><span style="color:#777"># Gemfile</span>
gem <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sidekiq</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">~&gt; 3.0</span><span style="color:#710">'</span></span>
gem <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sidekiq-failures</span><span style="color:#710">'</span></span>
gem <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sinatra</span><span style="color:#710">'</span></span>, <span style="color:#606">require</span>: <span style="color:#069">false</span>, <span style="color:#606">group</span>: [<span style="color:#A60">:development</span>, <span style="color:#A60">:production</span>]
</pre></div>
</div>

.
<div class="CodeRay">
  <div class="code"><pre><span style="color:#777"># routes.rb</span>
require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sidekiq/web</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">if</span> <span style="color:#080;font-weight:bold">defined?</span> <span style="color:#036;font-weight:bold">Sidekiq</span>

mount <span style="color:#036;font-weight:bold">Sidekiq</span>::<span style="color:#036;font-weight:bold">Web</span> =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">admin/sidekiq</span><span style="color:#710">'</span></span>
</pre></div>
</div>


</div>
<div class="slide">

	<h1>Background Jobs (3/3)</h1>


	<p>Worker-Klasse</p>


<div class="CodeRay">
  <div class="code"><pre><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">HardWorker</span>
  include <span style="color:#036;font-weight:bold">Sidekiq</span>::<span style="color:#036;font-weight:bold">Worker</span>
  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">perform</span>(name, count)
    puts <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Doing hard work</span><span style="color:#710">'</span></span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>


	<p>Job erstellen:</p>


<div class="CodeRay">
  <div class="code"><pre><span style="color:#036;font-weight:bold">HardWorker</span>.perform_async(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">bob</span><span style="color:#710">'</span></span>, <span style="color:#00D">5</span>)
</pre></div>
</div>


	<p>Starten:</p>


	<pre><code>bundle exec sidekiq</code></pre>


</div>
<div class="slide">

	<h1>Precompiler</h1>


	<p>Steigern der Produktivität mit:</p>


	<ul>
	<li><span class="caps">HAML</span> statt <span class="caps">ERB</span> (html2haml)</li>
		<li><span class="caps">SASS</span> statt <span class="caps">CSS</span> (css2sass)</li>
		<li>CoffeeScript statt JavaScript (js2coffee.org)</li>
	</ul>


</div>
<div class="slide">

	<h1>Testing</h1>


	<ul>
	<li>RSpec (beta2)</li>
		<li>FactoryGirl (factory_girl_rails)</li>
		<li>ffaker für Testdaten (zufällig!)</li>
		<li>Stubbing mit rspeck-mocks / <span class="caps">VCR</span>+Webmock</li>
		<li>Debugger: byebug (pry-byebug und pry-rails)</li>
		<li>Capybara mit Poltergeist, Launchy</li>
		<li>SimpleCov</li>
		<li>Cucumber</li>
	</ul>


</div>
<div class="slide">

	<h1>Sonstige Gems</h1>


	<ul>
	<li>devise für Authentifzierung</li>
		<li>cancan für Autorisierung</li>
		<li>carrier_wave für Datei-Uploads (nur Attachments)</li>
		<li>annotate</li>
		<li>strip_attributes</li>
		<li>letter_opener</li>
		<li>quiet_assets</li>
		<li>exception_notfication</li>
	</ul>


	<p>Gem gesucht? -&gt; www.ruby-toolbox.com</p>


</div>
<div class="slide">

	<h1>Seperation of Concerns</h1>


	<p>Verschiedene Elemente der Aufgabe sollten möglichst in verschiedenen Elementen der Lösung repräsentiert werden.
Also: Gleiche Elemente zusammenfassen</p>


	<ul>
	<li>ApplicationHelper löschen</li>
		<li>ApplicationController meiden</li>
		<li>application.{js,css} nur für require</li>
		<li>ActiveSupport::Concern verwenden</li>
	</ul>


</div>
<div class="slide">

	<h1>ActiveSupport::Concern</h1>


<div class="CodeRay">
  <div class="code"><pre><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">User</span> &lt; <span style="color:#036;font-weight:bold">ActiveRecord</span>::<span style="color:#036;font-weight:bold">Base</span>
  include <span style="color:#036;font-weight:bold">User</span>::<span style="color:#036;font-weight:bold">Validations</span>
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#777"># app/models/concerns/user/validations.rb</span>
<span style="color:#080;font-weight:bold">module</span> <span style="color:#B06;font-weight:bold">User::Validations</span>
  extend <span style="color:#036;font-weight:bold">ActiveSupport</span>::<span style="color:#036;font-weight:bold">Concern</span>

  included <span style="color:#080;font-weight:bold">do</span>
    validates <span style="color:#A60">:name</span>, <span style="color:#606">presence</span>: <span style="color:#069">true</span>
    validates <span style="color:#A60">:card_number</span>, <span style="color:#606">presence</span>: <span style="color:#069">true</span>, <span style="color:#606">if</span>: <span style="color:#A60">:card_required?</span>
  <span style="color:#080;font-weight:bold">end</span>

  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">card_required?</span>
    <span style="color:#777"># ...</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>


</div>
<div class="slide">

	<h1>Services</h1>


	<p>Tools für Entwurf und <span class="caps">SCRUM</span>:</p>


	<ul>
	<li>Mockingbird für Mockups (gomockingbird.com)</li>
		<li>Pivotal Tracker (pivotaltracker.com)</li>
	</ul>


	<p>CI / Code-Analyse</p>


	<ul>
	<li>Continuous Integration: Travis CI (travis-ci.com)</li>
		<li>Performance Monitoring: NewRelic <span class="caps">RPM</span> (newrelic.com)</li>
		<li>Code-Analyse: Code Climate (codeclimate.com)</li>
		<li>Test-Coverage: Coveralls (coveralls.com)</li>
	</ul>


</div>
<div class="slide">

	<h1>Arbeitsumgebung</h1>


	<p>Ergonomie</p>


	<ul>
	<li>optimal: sehr großer Bildschirm auf Augenhöhe
	<ul>
	<li>am besten 2 Stück</li>
	</ul>
	</li>
		<li>eine echte Maus (für nicht-MacBooks)</li>
	</ul>


	<p>Vernünftiger Editor!</p>


</div>
<div class="slide">

	<h1>Viel Erfolg!</h1>


	<p>Noch Fragen?</p>


</div>
<!-- ================================================================== -->
</div>

</body>
</html>
